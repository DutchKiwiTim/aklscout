// Foursquare API Credentials - Tim
// const client_id = '&client_id=' + 'Q5PQQNTJS4UGM10I1RWODUVC4XS2PBULBDYZKFLAFECJ4ZIM';
// const client_secret = '&client_secret=' + '4TMTXMB4LL35O3GR1QXONNBAJ5OCGZUO5HLWAQQGSHHPZZV2';

// // Foursquare API Credentials - Nikita
const client_id = '&client_id=' + '2F1JEBGBXWUCCK1VS5OZAFT2BELR15OCVOBRDEVCJFKQNDGM';
const client_secret = '&client_secret=' + 'UIK2BOJFZ1OEZJRBIMW35SOGRB1LFETJVWICBAVBE4JJVCJP';

// // Foursquare API Credentials - Louella
// const client_id = '&client_id=' + 'JSBCLUKSAG3BD0D1BOIRNAEMKWTQY0P401LJCYETQQXBS3W0';
// const client_secret = '&client_secret=' + 'HSRPRSP1SQJWTG3NN2EOBPCASHO52SBOU4ZPFXOJPZYIL3DK';
// Step 2 - Link the html element to the foursquare category ID
function identifyCategory(e) {
  // declare variables
  let chosenRadius = '0';
  let chosenCategory = '0';
  // simple conditional to match the DOM element to the api ID
  if (e.id == 'jsCatParks') {
    chosenRadius = '2000';
    chosenCategory = '4bf58dd8d48988d163941735';
    createSearchRequestURI(chosenRadius, chosenCategory);

  } else if (e.id == 'jsCatBeaches') {
    chosenRadius = '2000';
    chosenCategory = '4bf58dd8d48988d1e2941735';
    createSearchRequestURI(chosenRadius, chosenCategory);

  } else if (e.id == 'jsCatLookouts') {
    chosenRadius = '2000';
    chosenCategory = '4bf58dd8d48988d165941735';
    createSearchRequestURI(chosenRadius, chosenCategory);
  }
}


// Step 3 - Create the search query request uri
function createSearchRequestURI(rad, cat) {
  const baseURI = 'https://api.foursquare.com/v2/venues/search?v=20170901';
  // const client_id = '&client_id=' + 'Q5PQQNTJS4UGM10I1RWODUVC4XS2PBULBDYZKFLAFECJ4ZIM';
  // const client_secret = '&client_secret=' + '4TMTXMB4LL35O3GR1QXONNBAJ5OCGZUO5HLWAQQGSHHPZZV2';
  const latlong = '&ll=' + '-36.8786499,174.7602798';
  // This value will be a variable
  const radius = '&radius=' + rad;
  // This value will be a variable
  const categoryId = '&categoryId=' + cat;
  // Put all the pieces together
  const requestURI = baseURI + client_id + client_secret + latlong + radius + categoryId;
  
  makeSearchRequest(requestURI);
}


// Step 4 - Make the actual request
function makeSearchRequest(uri) {
  fetch(uri)
    .then(function(response) {
      return response.json();
    })
    .then(function(myJson) {
      extractNeededData(myJson.response.venues);
      //console.log(myJson.response.venues);
    })
    .catch(function(error) {
      // Code for handling errors
      console.log(error);
    });
}


// Step 5 - Extract the data we are using from the json response
function extractNeededData(data) {

  // declare empty array
  const venuesForMap = [];

  // Loop through json response
  data.forEach(venue => {

    // Push the name, ID, and latlng into an array to use for the map
    venuesForMap.push({
      name: venue.name,
      id: venue.id,
      latlng: 
        [
          venue.location.lat,
          venue.location.lng
        ]
      
    });
  });

  createMap(venuesForMap);
}




  
// Tim's work START
// Categories:
// Parks: 4bf58dd8d48988d163941735
// Beaches: 4bf58dd8d48988d1e2941735
// Pools: 4bf58dd8d48988d15e941735
// Scenic Lookout: 4bf58dd8d48988d165941735
// Skate Park: 4bf58dd8d48988d167941735


// Identifiers
// Every ID prefixed with 'js' is a DOM element
const jsCatDropdown = document.getElementById('jsCatDropdown');
const jsCatTrending = document.getElementById('jsCatTrending');
const jsCatParks = document.getElementById('jsCatParks');
const jsCatBeaches = document.getElementById('jsCatBeaches');
const jsCatLookouts = document.getElementById('jsCatLookouts');
// Modal identifiers
const jsPopUpButton = document.getElementById('#modalCenter');
const jsModalLongTitle = document.getElementById('jsModalLongTitle');
const jsVenueImg = document.getElementById('jsVenueImg');
const jsVenueDescription = document.getElementById('jsVenueDescription');
const jsVenueWebsite = document.getElementById('jsVenueWebsite');
const jsMiniMap = document.getElementById('jsMiniMap');
const jsDirections = document.getElementById('jsDirections');
// this needs to be a global variable in order to access it from different functions
let mymap;
let zoom = 0;
// Tim's work END

document.addEventListener("DOMContentLoaded", () => {
  console.log("DOM ready!");

  // identify the event target
  jsCatDropdown.addEventListener('click', (e) => {
    identifyCategory(e.target);
  });

  // Load the empty map on page load
  createInitialMap();

});


// Detect screen width and change zoom accordingly - by Nikita
function detectScreenWidth() {

  if ($(window).width() < 768) {
    let zoom = 10;
    console.log('screen size is less than 768px');
    return zoom;
  }
  else {
    let zoom = 11;
    console.log('screen size is less than 768px');
    return zoom;
  };
}


function createInitialMap() {

  // detect screen size
  let z = detectScreenWidth();

  // Map work by Nikita START
  let center = [-36.8977931, 174.7854973];
  mymap = L.map('mapid').setView(center, z);

  L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoidGhhbHl4OTAiLCJhIjoiY2o2YjdrZHRlMWJmYjJybDd2cW1rYnVnNSJ9.j_DQLfixHfhioVjH6qmqkw', {
    attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
    maxZoom: 18,
    id: 'mapbox.streets',
    accessToken: 'pk.eyJ1IjoibmlraXRhaG9pbmVzIiwiYSI6ImNqc203cHN5NDEwaGg0OXBpYnE0aXhhZmYifQ.58l8dUZg4uiFn7BYnZCJFA'
  }).addTo(mymap);

  // radius
  L.circle(center, {
    radius: 21500,
    color: 'salmon',
    weight: 1,
    fill: true
  }).addTo(mymap);
  // Map work by Nikita END
}

function createMap(v) {

  // detect screen size
  let z = detectScreenWidth();

  // remove previously loaded map first
  if (mymap) {
    mymap.remove();
  }

  // Map work by Nikita START
  let center = [-36.8977931, 174.7854973];
  mymap = L.map('mapid').setView(center, z);

  L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoidGhhbHl4OTAiLCJhIjoiY2o2YjdrZHRlMWJmYjJybDd2cW1rYnVnNSJ9.j_DQLfixHfhioVjH6qmqkw', {
    attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
    maxZoom: 18,
    id: 'mapbox.streets',
    accessToken: 'pk.eyJ1IjoibmlraXRhaG9pbmVzIiwiYSI6ImNqc203cHN5NDEwaGg0OXBpYnE0aXhhZmYifQ.58l8dUZg4uiFn7BYnZCJFA'
  }).addTo(mymap);

  // radius
  L.circle(center, {
    radius: 21500,
    color: 'salmon',
    weight: 1,
    fill: true
  }).addTo(mymap);

  // nikita - putting markers on the map
  v.forEach(function (venue) {
    try {
      var serviceIcon = L.icon({
        iconUrl: '../build/img/pin.svg',
        iconSize: [72, 72],
        popupAnchor: [0, -36]
      });
      var marker = L.marker(venue.latlng, { icon: serviceIcon }).addTo(mymap);
      marker.bindPopup('<div>' + venue.name + '</div>' + '<button type="button" id="' + venue.id + '" class="btn btn-primary" data-toggle="modal" data-target="#modalCenter">' + 'Explore' + '</button>')

      //louella - target pop up button to populate details
      const version = '?v=20170901';
      const key = version + client_id + client_secret;
      const venueId = venue.id;
      const baseURL = 'https://api.foursquare.com/v2/venues/';
      let venueUrl = baseURL + venueId + key;

      marker.on('popupopen', () => {
        // pop up button
        const jsPopUpButton = document.getElementById(venue.id);
        // click function
        jsPopUpButton.addEventListener('click', (e) => {
          console.log(e.target);
          //Add venue details through API call
          fetchVenue(venueUrl);
        });
      })

    } catch (error) {
      console.log(error);
    }
  });
}

// Step 4 - Make the actual request
function fetchVenue(uri) {
  fetch(uri)
    .then(function (response) {
      // a. return response in json format
      return response.json();
    })
    .then(function (myJson) {
      // b. extract data from response and run this function
      venueDetails(myJson.response);
    })
    .catch(function (error) {
      // Code for handling errors
      console.log(error);
    });
}

function venueDetails(res) {

  console.log(res);
  // Modal title
  jsModalLongTitle.innerHTML = res.venue.name;

  // // Clear/reset modal body copy so it's empty, before we add new data
  // if ( ) {
  // $('.modal-body').empty();
  // $('.modal-footer').empty();
  // }


  // // Venue description
  // if (res.venue.description !== undefined) {
  //   jsVenueDescription.innerHTML = res.venue.description;
  // }

  //Construct modal image/
  if (res.venue.photos.groups.length > 0) {
    const photoPrefix = res.venue.bestPhoto.prefix;
    const photoSuffix = res.venue.bestPhoto.suffix;
    jsVenueImg.src = photoPrefix + '720x720' + photoSuffix;
  }

  // Add website
    if (res.venue.shortUrl !== undefined) {
      jsVenueWebsite.href = res.venue.shortUrl;
  }

  
  console.log('hello')
  window.fake = res;

  // Add address
  if (res.venue.location.address !== undefined) {
    jsVenueWebsite.innerHTML = res.venue.location.address + ', ' + res.venue.location.city;
  }

  // Insert Mini map with user location https://leafletjs.com/reference-1.0.0.html
  // remove previously loaded map first

  // if (miniMap) {
  //   miniMap.remove();
  // }
  // let userLocation = [-36.8977931, 174.7854973];
  // let miniMap = L.map('jsMiniMap', {
  //   scrollWheelZoom: false
  // }).setView(userLocation, 17);
  // L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
  //   attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
  //   maxZoom: 18,
  //   id: 'mapbox.streets',
  //   accessToken: 'pk.eyJ1IjoibmlraXRhaG9pbmVzIiwiYSI6ImNqc203cHN5NDEwaGg0OXBpYnE0aXhhZmYifQ.58l8dUZg4uiFn7BYnZCJFA'
  // }).addTo(miniMap);

  // Now toggle the Modal
  $('#modalCenter').modal('show');


};
// Work from Louella



// // Modal identifiers
// const jsPopUpButton = document.getElementById('#modalCenter');
// const jsModalLongTitle = document.getElementById('jsModalLongTitle');
// const jsVenueImg = document.getElementById('jsVenueImg');
// const jsVenueDescription = document.getElementById('jsVenueDescription');
// const jsVenueWebsite = document.getElementById('jsVenueWebsite');
// const jsMiniMap = document.getElementById('jsMiniMap');
// const jsDirections = document.getElementById('jsDirections');

// Load modal
// function modal() {
//     $('#modalCenter').on('shown.bs.modal', function () {
//         //Add venue details through API call
//         displayVenueDetails(venueUrl);
//     });
// }

// // Step 3 - Create the venue on click request url
// const version = '?v=20170901';
// const key = version + client_id + client_secret;
// const venueId = '59a45921351e3d43b07028b5';
// const baseURL = 'https://api.foursquare.com/v2/venues/';
// let venueUrl = baseURL + venueId + key;


// displayVenueDetails(venueUrl);
// // Step 4 - Make the actual request
// function displayVenueDetails(uri) {
//     fetch(uri)
//         .then(function (response) {
//             return response.json();
//             console.log(response.json);
//         })
//         .catch(function (error) {
//             // Code for handling errors
//             console.log(error);
//         });
// }







//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiIiwic291cmNlcyI6WyJhcHAubWluLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIEZvdXJzcXVhcmUgQVBJIENyZWRlbnRpYWxzIC0gVGltXG4vLyBjb25zdCBjbGllbnRfaWQgPSAnJmNsaWVudF9pZD0nICsgJ1E1UFFRTlRKUzRVR00xMEkxUldPRFVWQzRYUzJQQlVMQkRZWktGTEFGRUNKNFpJTSc7XG4vLyBjb25zdCBjbGllbnRfc2VjcmV0ID0gJyZjbGllbnRfc2VjcmV0PScgKyAnNFRNVFhNQjRMTDM1TzNHUjFRWE9OTkJBSjVPQ0daVU81SExXQVFRR1NISFBaWlYyJztcblxuLy8gLy8gRm91cnNxdWFyZSBBUEkgQ3JlZGVudGlhbHMgLSBOaWtpdGFcbmNvbnN0IGNsaWVudF9pZCA9ICcmY2xpZW50X2lkPScgKyAnMkYxSkVCR0JYV1VDQ0sxVlM1T1pBRlQyQkVMUjE1T0NWT0JSREVWQ0pGS1FOREdNJztcbmNvbnN0IGNsaWVudF9zZWNyZXQgPSAnJmNsaWVudF9zZWNyZXQ9JyArICdVSUsyQk9KRloxT0VaSlJCSU1XMzVTT0dSQjFMRkVUSlZXSUNCQVZCRTRKSlZDSlAnO1xuXG4vLyAvLyBGb3Vyc3F1YXJlIEFQSSBDcmVkZW50aWFscyAtIExvdWVsbGFcbi8vIGNvbnN0IGNsaWVudF9pZCA9ICcmY2xpZW50X2lkPScgKyAnSlNCQ0xVS1NBRzNCRDBEMUJPSVJOQUVNS1dUUVkwUDQwMUxKQ1lFVFFRWEJTM1cwJztcbi8vIGNvbnN0IGNsaWVudF9zZWNyZXQgPSAnJmNsaWVudF9zZWNyZXQ9JyArICdIU1JQUlNQMVNRSldURzNOTjJFT0JQQ0FTSE81MlNCT1U0WlBGWE9KUFpZSUwzREsnO1xuLy8gU3RlcCAyIC0gTGluayB0aGUgaHRtbCBlbGVtZW50IHRvIHRoZSBmb3Vyc3F1YXJlIGNhdGVnb3J5IElEXG5mdW5jdGlvbiBpZGVudGlmeUNhdGVnb3J5KGUpIHtcbiAgLy8gZGVjbGFyZSB2YXJpYWJsZXNcbiAgbGV0IGNob3NlblJhZGl1cyA9ICcwJztcbiAgbGV0IGNob3NlbkNhdGVnb3J5ID0gJzAnO1xuICAvLyBzaW1wbGUgY29uZGl0aW9uYWwgdG8gbWF0Y2ggdGhlIERPTSBlbGVtZW50IHRvIHRoZSBhcGkgSURcbiAgaWYgKGUuaWQgPT0gJ2pzQ2F0UGFya3MnKSB7XG4gICAgY2hvc2VuUmFkaXVzID0gJzIwMDAnO1xuICAgIGNob3NlbkNhdGVnb3J5ID0gJzRiZjU4ZGQ4ZDQ4OTg4ZDE2Mzk0MTczNSc7XG4gICAgY3JlYXRlU2VhcmNoUmVxdWVzdFVSSShjaG9zZW5SYWRpdXMsIGNob3NlbkNhdGVnb3J5KTtcblxuICB9IGVsc2UgaWYgKGUuaWQgPT0gJ2pzQ2F0QmVhY2hlcycpIHtcbiAgICBjaG9zZW5SYWRpdXMgPSAnMjAwMCc7XG4gICAgY2hvc2VuQ2F0ZWdvcnkgPSAnNGJmNThkZDhkNDg5ODhkMWUyOTQxNzM1JztcbiAgICBjcmVhdGVTZWFyY2hSZXF1ZXN0VVJJKGNob3NlblJhZGl1cywgY2hvc2VuQ2F0ZWdvcnkpO1xuXG4gIH0gZWxzZSBpZiAoZS5pZCA9PSAnanNDYXRMb29rb3V0cycpIHtcbiAgICBjaG9zZW5SYWRpdXMgPSAnMjAwMCc7XG4gICAgY2hvc2VuQ2F0ZWdvcnkgPSAnNGJmNThkZDhkNDg5ODhkMTY1OTQxNzM1JztcbiAgICBjcmVhdGVTZWFyY2hSZXF1ZXN0VVJJKGNob3NlblJhZGl1cywgY2hvc2VuQ2F0ZWdvcnkpO1xuICB9XG59XG5cblxuLy8gU3RlcCAzIC0gQ3JlYXRlIHRoZSBzZWFyY2ggcXVlcnkgcmVxdWVzdCB1cmlcbmZ1bmN0aW9uIGNyZWF0ZVNlYXJjaFJlcXVlc3RVUkkocmFkLCBjYXQpIHtcbiAgY29uc3QgYmFzZVVSSSA9ICdodHRwczovL2FwaS5mb3Vyc3F1YXJlLmNvbS92Mi92ZW51ZXMvc2VhcmNoP3Y9MjAxNzA5MDEnO1xuICAvLyBjb25zdCBjbGllbnRfaWQgPSAnJmNsaWVudF9pZD0nICsgJ1E1UFFRTlRKUzRVR00xMEkxUldPRFVWQzRYUzJQQlVMQkRZWktGTEFGRUNKNFpJTSc7XG4gIC8vIGNvbnN0IGNsaWVudF9zZWNyZXQgPSAnJmNsaWVudF9zZWNyZXQ9JyArICc0VE1UWE1CNExMMzVPM0dSMVFYT05OQkFKNU9DR1pVTzVITFdBUVFHU0hIUFpaVjInO1xuICBjb25zdCBsYXRsb25nID0gJyZsbD0nICsgJy0zNi44Nzg2NDk5LDE3NC43NjAyNzk4JztcbiAgLy8gVGhpcyB2YWx1ZSB3aWxsIGJlIGEgdmFyaWFibGVcbiAgY29uc3QgcmFkaXVzID0gJyZyYWRpdXM9JyArIHJhZDtcbiAgLy8gVGhpcyB2YWx1ZSB3aWxsIGJlIGEgdmFyaWFibGVcbiAgY29uc3QgY2F0ZWdvcnlJZCA9ICcmY2F0ZWdvcnlJZD0nICsgY2F0O1xuICAvLyBQdXQgYWxsIHRoZSBwaWVjZXMgdG9nZXRoZXJcbiAgY29uc3QgcmVxdWVzdFVSSSA9IGJhc2VVUkkgKyBjbGllbnRfaWQgKyBjbGllbnRfc2VjcmV0ICsgbGF0bG9uZyArIHJhZGl1cyArIGNhdGVnb3J5SWQ7XG4gIFxuICBtYWtlU2VhcmNoUmVxdWVzdChyZXF1ZXN0VVJJKTtcbn1cblxuXG4vLyBTdGVwIDQgLSBNYWtlIHRoZSBhY3R1YWwgcmVxdWVzdFxuZnVuY3Rpb24gbWFrZVNlYXJjaFJlcXVlc3QodXJpKSB7XG4gIGZldGNoKHVyaSlcbiAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcbiAgICB9KVxuICAgIC50aGVuKGZ1bmN0aW9uKG15SnNvbikge1xuICAgICAgZXh0cmFjdE5lZWRlZERhdGEobXlKc29uLnJlc3BvbnNlLnZlbnVlcyk7XG4gICAgICAvL2NvbnNvbGUubG9nKG15SnNvbi5yZXNwb25zZS52ZW51ZXMpO1xuICAgIH0pXG4gICAgLmNhdGNoKGZ1bmN0aW9uKGVycm9yKSB7XG4gICAgICAvLyBDb2RlIGZvciBoYW5kbGluZyBlcnJvcnNcbiAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICB9KTtcbn1cblxuXG4vLyBTdGVwIDUgLSBFeHRyYWN0IHRoZSBkYXRhIHdlIGFyZSB1c2luZyBmcm9tIHRoZSBqc29uIHJlc3BvbnNlXG5mdW5jdGlvbiBleHRyYWN0TmVlZGVkRGF0YShkYXRhKSB7XG5cbiAgLy8gZGVjbGFyZSBlbXB0eSBhcnJheVxuICBjb25zdCB2ZW51ZXNGb3JNYXAgPSBbXTtcblxuICAvLyBMb29wIHRocm91Z2gganNvbiByZXNwb25zZVxuICBkYXRhLmZvckVhY2godmVudWUgPT4ge1xuXG4gICAgLy8gUHVzaCB0aGUgbmFtZSwgSUQsIGFuZCBsYXRsbmcgaW50byBhbiBhcnJheSB0byB1c2UgZm9yIHRoZSBtYXBcbiAgICB2ZW51ZXNGb3JNYXAucHVzaCh7XG4gICAgICBuYW1lOiB2ZW51ZS5uYW1lLFxuICAgICAgaWQ6IHZlbnVlLmlkLFxuICAgICAgbGF0bG5nOiBcbiAgICAgICAgW1xuICAgICAgICAgIHZlbnVlLmxvY2F0aW9uLmxhdCxcbiAgICAgICAgICB2ZW51ZS5sb2NhdGlvbi5sbmdcbiAgICAgICAgXVxuICAgICAgXG4gICAgfSk7XG4gIH0pO1xuXG4gIGNyZWF0ZU1hcCh2ZW51ZXNGb3JNYXApO1xufVxuXG5cblxuXG4gIFxuLy8gVGltJ3Mgd29yayBTVEFSVFxuLy8gQ2F0ZWdvcmllczpcbi8vIFBhcmtzOiA0YmY1OGRkOGQ0ODk4OGQxNjM5NDE3MzVcbi8vIEJlYWNoZXM6IDRiZjU4ZGQ4ZDQ4OTg4ZDFlMjk0MTczNVxuLy8gUG9vbHM6IDRiZjU4ZGQ4ZDQ4OTg4ZDE1ZTk0MTczNVxuLy8gU2NlbmljIExvb2tvdXQ6IDRiZjU4ZGQ4ZDQ4OTg4ZDE2NTk0MTczNVxuLy8gU2thdGUgUGFyazogNGJmNThkZDhkNDg5ODhkMTY3OTQxNzM1XG5cblxuLy8gSWRlbnRpZmllcnNcbi8vIEV2ZXJ5IElEIHByZWZpeGVkIHdpdGggJ2pzJyBpcyBhIERPTSBlbGVtZW50XG5jb25zdCBqc0NhdERyb3Bkb3duID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2pzQ2F0RHJvcGRvd24nKTtcbmNvbnN0IGpzQ2F0VHJlbmRpbmcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnanNDYXRUcmVuZGluZycpO1xuY29uc3QganNDYXRQYXJrcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdqc0NhdFBhcmtzJyk7XG5jb25zdCBqc0NhdEJlYWNoZXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnanNDYXRCZWFjaGVzJyk7XG5jb25zdCBqc0NhdExvb2tvdXRzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2pzQ2F0TG9va291dHMnKTtcbi8vIE1vZGFsIGlkZW50aWZpZXJzXG5jb25zdCBqc1BvcFVwQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJyNtb2RhbENlbnRlcicpO1xuY29uc3QganNNb2RhbExvbmdUaXRsZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdqc01vZGFsTG9uZ1RpdGxlJyk7XG5jb25zdCBqc1ZlbnVlSW1nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2pzVmVudWVJbWcnKTtcbmNvbnN0IGpzVmVudWVEZXNjcmlwdGlvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdqc1ZlbnVlRGVzY3JpcHRpb24nKTtcbmNvbnN0IGpzVmVudWVXZWJzaXRlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2pzVmVudWVXZWJzaXRlJyk7XG5jb25zdCBqc01pbmlNYXAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnanNNaW5pTWFwJyk7XG5jb25zdCBqc0RpcmVjdGlvbnMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnanNEaXJlY3Rpb25zJyk7XG4vLyB0aGlzIG5lZWRzIHRvIGJlIGEgZ2xvYmFsIHZhcmlhYmxlIGluIG9yZGVyIHRvIGFjY2VzcyBpdCBmcm9tIGRpZmZlcmVudCBmdW5jdGlvbnNcbmxldCBteW1hcDtcbmxldCB6b29tID0gMDtcbi8vIFRpbSdzIHdvcmsgRU5EXG5cbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Db250ZW50TG9hZGVkXCIsICgpID0+IHtcbiAgY29uc29sZS5sb2coXCJET00gcmVhZHkhXCIpO1xuXG4gIC8vIGlkZW50aWZ5IHRoZSBldmVudCB0YXJnZXRcbiAganNDYXREcm9wZG93bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgaWRlbnRpZnlDYXRlZ29yeShlLnRhcmdldCk7XG4gIH0pO1xuXG4gIC8vIExvYWQgdGhlIGVtcHR5IG1hcCBvbiBwYWdlIGxvYWRcbiAgY3JlYXRlSW5pdGlhbE1hcCgpO1xuXG59KTtcblxuXG4vLyBEZXRlY3Qgc2NyZWVuIHdpZHRoIGFuZCBjaGFuZ2Ugem9vbSBhY2NvcmRpbmdseSAtIGJ5IE5pa2l0YVxuZnVuY3Rpb24gZGV0ZWN0U2NyZWVuV2lkdGgoKSB7XG5cbiAgaWYgKCQod2luZG93KS53aWR0aCgpIDwgNzY4KSB7XG4gICAgbGV0IHpvb20gPSAxMDtcbiAgICBjb25zb2xlLmxvZygnc2NyZWVuIHNpemUgaXMgbGVzcyB0aGFuIDc2OHB4Jyk7XG4gICAgcmV0dXJuIHpvb207XG4gIH1cbiAgZWxzZSB7XG4gICAgbGV0IHpvb20gPSAxMTtcbiAgICBjb25zb2xlLmxvZygnc2NyZWVuIHNpemUgaXMgbGVzcyB0aGFuIDc2OHB4Jyk7XG4gICAgcmV0dXJuIHpvb207XG4gIH07XG59XG5cblxuZnVuY3Rpb24gY3JlYXRlSW5pdGlhbE1hcCgpIHtcblxuICAvLyBkZXRlY3Qgc2NyZWVuIHNpemVcbiAgbGV0IHogPSBkZXRlY3RTY3JlZW5XaWR0aCgpO1xuXG4gIC8vIE1hcCB3b3JrIGJ5IE5pa2l0YSBTVEFSVFxuICBsZXQgY2VudGVyID0gWy0zNi44OTc3OTMxLCAxNzQuNzg1NDk3M107XG4gIG15bWFwID0gTC5tYXAoJ21hcGlkJykuc2V0VmlldyhjZW50ZXIsIHopO1xuXG4gIEwudGlsZUxheWVyKCdodHRwczovL2FwaS50aWxlcy5tYXBib3guY29tL3Y0L3tpZH0ve3p9L3t4fS97eX0ucG5nP2FjY2Vzc190b2tlbj1way5leUoxSWpvaWRHaGhiSGw0T1RBaUxDSmhJam9pWTJvMllqZHJaSFJsTVdKbVlqSnliRGQyY1cxclluVm5OU0o5LmpfRFFMZml4SGZoaW9Wakg2cW1xa3cnLCB7XG4gICAgYXR0cmlidXRpb246ICdNYXAgZGF0YSAmY29weTsgPGEgaHJlZj1cImh0dHBzOi8vd3d3Lm9wZW5zdHJlZXRtYXAub3JnL1wiPk9wZW5TdHJlZXRNYXA8L2E+IGNvbnRyaWJ1dG9ycywgPGEgaHJlZj1cImh0dHBzOi8vY3JlYXRpdmVjb21tb25zLm9yZy9saWNlbnNlcy9ieS1zYS8yLjAvXCI+Q0MtQlktU0E8L2E+LCBJbWFnZXJ5IMKpIDxhIGhyZWY9XCJodHRwczovL3d3dy5tYXBib3guY29tL1wiPk1hcGJveDwvYT4nLFxuICAgIG1heFpvb206IDE4LFxuICAgIGlkOiAnbWFwYm94LnN0cmVldHMnLFxuICAgIGFjY2Vzc1Rva2VuOiAncGsuZXlKMUlqb2libWxyYVhSaGFHOXBibVZ6SWl3aVlTSTZJbU5xYzIwM2NITjVOREV3YUdnME9YQnBZbkUwYVhoaFptWWlmUS41OGw4ZFVaZzR1aUZuN0JZblpDSkZBJ1xuICB9KS5hZGRUbyhteW1hcCk7XG5cbiAgLy8gcmFkaXVzXG4gIEwuY2lyY2xlKGNlbnRlciwge1xuICAgIHJhZGl1czogMjE1MDAsXG4gICAgY29sb3I6ICdzYWxtb24nLFxuICAgIHdlaWdodDogMSxcbiAgICBmaWxsOiB0cnVlXG4gIH0pLmFkZFRvKG15bWFwKTtcbiAgLy8gTWFwIHdvcmsgYnkgTmlraXRhIEVORFxufVxuXG5mdW5jdGlvbiBjcmVhdGVNYXAodikge1xuXG4gIC8vIGRldGVjdCBzY3JlZW4gc2l6ZVxuICBsZXQgeiA9IGRldGVjdFNjcmVlbldpZHRoKCk7XG5cbiAgLy8gcmVtb3ZlIHByZXZpb3VzbHkgbG9hZGVkIG1hcCBmaXJzdFxuICBpZiAobXltYXApIHtcbiAgICBteW1hcC5yZW1vdmUoKTtcbiAgfVxuXG4gIC8vIE1hcCB3b3JrIGJ5IE5pa2l0YSBTVEFSVFxuICBsZXQgY2VudGVyID0gWy0zNi44OTc3OTMxLCAxNzQuNzg1NDk3M107XG4gIG15bWFwID0gTC5tYXAoJ21hcGlkJykuc2V0VmlldyhjZW50ZXIsIHopO1xuXG4gIEwudGlsZUxheWVyKCdodHRwczovL2FwaS50aWxlcy5tYXBib3guY29tL3Y0L3tpZH0ve3p9L3t4fS97eX0ucG5nP2FjY2Vzc190b2tlbj1way5leUoxSWpvaWRHaGhiSGw0T1RBaUxDSmhJam9pWTJvMllqZHJaSFJsTVdKbVlqSnliRGQyY1cxclluVm5OU0o5LmpfRFFMZml4SGZoaW9Wakg2cW1xa3cnLCB7XG4gICAgYXR0cmlidXRpb246ICdNYXAgZGF0YSAmY29weTsgPGEgaHJlZj1cImh0dHBzOi8vd3d3Lm9wZW5zdHJlZXRtYXAub3JnL1wiPk9wZW5TdHJlZXRNYXA8L2E+IGNvbnRyaWJ1dG9ycywgPGEgaHJlZj1cImh0dHBzOi8vY3JlYXRpdmVjb21tb25zLm9yZy9saWNlbnNlcy9ieS1zYS8yLjAvXCI+Q0MtQlktU0E8L2E+LCBJbWFnZXJ5IMKpIDxhIGhyZWY9XCJodHRwczovL3d3dy5tYXBib3guY29tL1wiPk1hcGJveDwvYT4nLFxuICAgIG1heFpvb206IDE4LFxuICAgIGlkOiAnbWFwYm94LnN0cmVldHMnLFxuICAgIGFjY2Vzc1Rva2VuOiAncGsuZXlKMUlqb2libWxyYVhSaGFHOXBibVZ6SWl3aVlTSTZJbU5xYzIwM2NITjVOREV3YUdnME9YQnBZbkUwYVhoaFptWWlmUS41OGw4ZFVaZzR1aUZuN0JZblpDSkZBJ1xuICB9KS5hZGRUbyhteW1hcCk7XG5cbiAgLy8gcmFkaXVzXG4gIEwuY2lyY2xlKGNlbnRlciwge1xuICAgIHJhZGl1czogMjE1MDAsXG4gICAgY29sb3I6ICdzYWxtb24nLFxuICAgIHdlaWdodDogMSxcbiAgICBmaWxsOiB0cnVlXG4gIH0pLmFkZFRvKG15bWFwKTtcblxuICAvLyBuaWtpdGEgLSBwdXR0aW5nIG1hcmtlcnMgb24gdGhlIG1hcFxuICB2LmZvckVhY2goZnVuY3Rpb24gKHZlbnVlKSB7XG4gICAgdHJ5IHtcbiAgICAgIHZhciBzZXJ2aWNlSWNvbiA9IEwuaWNvbih7XG4gICAgICAgIGljb25Vcmw6ICcuLi9idWlsZC9pbWcvcGluLnN2ZycsXG4gICAgICAgIGljb25TaXplOiBbNzIsIDcyXSxcbiAgICAgICAgcG9wdXBBbmNob3I6IFswLCAtMzZdXG4gICAgICB9KTtcbiAgICAgIHZhciBtYXJrZXIgPSBMLm1hcmtlcih2ZW51ZS5sYXRsbmcsIHsgaWNvbjogc2VydmljZUljb24gfSkuYWRkVG8obXltYXApO1xuICAgICAgbWFya2VyLmJpbmRQb3B1cCgnPGRpdj4nICsgdmVudWUubmFtZSArICc8L2Rpdj4nICsgJzxidXR0b24gdHlwZT1cImJ1dHRvblwiIGlkPVwiJyArIHZlbnVlLmlkICsgJ1wiIGNsYXNzPVwiYnRuIGJ0bi1wcmltYXJ5XCIgZGF0YS10b2dnbGU9XCJtb2RhbFwiIGRhdGEtdGFyZ2V0PVwiI21vZGFsQ2VudGVyXCI+JyArICdFeHBsb3JlJyArICc8L2J1dHRvbj4nKVxuXG4gICAgICAvL2xvdWVsbGEgLSB0YXJnZXQgcG9wIHVwIGJ1dHRvbiB0byBwb3B1bGF0ZSBkZXRhaWxzXG4gICAgICBjb25zdCB2ZXJzaW9uID0gJz92PTIwMTcwOTAxJztcbiAgICAgIGNvbnN0IGtleSA9IHZlcnNpb24gKyBjbGllbnRfaWQgKyBjbGllbnRfc2VjcmV0O1xuICAgICAgY29uc3QgdmVudWVJZCA9IHZlbnVlLmlkO1xuICAgICAgY29uc3QgYmFzZVVSTCA9ICdodHRwczovL2FwaS5mb3Vyc3F1YXJlLmNvbS92Mi92ZW51ZXMvJztcbiAgICAgIGxldCB2ZW51ZVVybCA9IGJhc2VVUkwgKyB2ZW51ZUlkICsga2V5O1xuXG4gICAgICBtYXJrZXIub24oJ3BvcHVwb3BlbicsICgpID0+IHtcbiAgICAgICAgLy8gcG9wIHVwIGJ1dHRvblxuICAgICAgICBjb25zdCBqc1BvcFVwQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodmVudWUuaWQpO1xuICAgICAgICAvLyBjbGljayBmdW5jdGlvblxuICAgICAgICBqc1BvcFVwQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhlLnRhcmdldCk7XG4gICAgICAgICAgLy9BZGQgdmVudWUgZGV0YWlscyB0aHJvdWdoIEFQSSBjYWxsXG4gICAgICAgICAgZmV0Y2hWZW51ZSh2ZW51ZVVybCk7XG4gICAgICAgIH0pO1xuICAgICAgfSlcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgfVxuICB9KTtcbn1cblxuLy8gU3RlcCA0IC0gTWFrZSB0aGUgYWN0dWFsIHJlcXVlc3RcbmZ1bmN0aW9uIGZldGNoVmVudWUodXJpKSB7XG4gIGZldGNoKHVyaSlcbiAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgIC8vIGEuIHJldHVybiByZXNwb25zZSBpbiBqc29uIGZvcm1hdFxuICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcbiAgICB9KVxuICAgIC50aGVuKGZ1bmN0aW9uIChteUpzb24pIHtcbiAgICAgIC8vIGIuIGV4dHJhY3QgZGF0YSBmcm9tIHJlc3BvbnNlIGFuZCBydW4gdGhpcyBmdW5jdGlvblxuICAgICAgdmVudWVEZXRhaWxzKG15SnNvbi5yZXNwb25zZSk7XG4gICAgfSlcbiAgICAuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAvLyBDb2RlIGZvciBoYW5kbGluZyBlcnJvcnNcbiAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gdmVudWVEZXRhaWxzKHJlcykge1xuXG4gIGNvbnNvbGUubG9nKHJlcyk7XG4gIC8vIE1vZGFsIHRpdGxlXG4gIGpzTW9kYWxMb25nVGl0bGUuaW5uZXJIVE1MID0gcmVzLnZlbnVlLm5hbWU7XG5cbiAgLy8gLy8gQ2xlYXIvcmVzZXQgbW9kYWwgYm9keSBjb3B5IHNvIGl0J3MgZW1wdHksIGJlZm9yZSB3ZSBhZGQgbmV3IGRhdGFcbiAgLy8gaWYgKCApIHtcbiAgLy8gJCgnLm1vZGFsLWJvZHknKS5lbXB0eSgpO1xuICAvLyAkKCcubW9kYWwtZm9vdGVyJykuZW1wdHkoKTtcbiAgLy8gfVxuXG5cbiAgLy8gLy8gVmVudWUgZGVzY3JpcHRpb25cbiAgLy8gaWYgKHJlcy52ZW51ZS5kZXNjcmlwdGlvbiAhPT0gdW5kZWZpbmVkKSB7XG4gIC8vICAganNWZW51ZURlc2NyaXB0aW9uLmlubmVySFRNTCA9IHJlcy52ZW51ZS5kZXNjcmlwdGlvbjtcbiAgLy8gfVxuXG4gIC8vQ29uc3RydWN0IG1vZGFsIGltYWdlL1xuICBpZiAocmVzLnZlbnVlLnBob3Rvcy5ncm91cHMubGVuZ3RoID4gMCkge1xuICAgIGNvbnN0IHBob3RvUHJlZml4ID0gcmVzLnZlbnVlLmJlc3RQaG90by5wcmVmaXg7XG4gICAgY29uc3QgcGhvdG9TdWZmaXggPSByZXMudmVudWUuYmVzdFBob3RvLnN1ZmZpeDtcbiAgICBqc1ZlbnVlSW1nLnNyYyA9IHBob3RvUHJlZml4ICsgJzcyMHg3MjAnICsgcGhvdG9TdWZmaXg7XG4gIH1cblxuICAvLyBBZGQgd2Vic2l0ZVxuICAgIGlmIChyZXMudmVudWUuc2hvcnRVcmwgIT09IHVuZGVmaW5lZCkge1xuICAgICAganNWZW51ZVdlYnNpdGUuaHJlZiA9IHJlcy52ZW51ZS5zaG9ydFVybDtcbiAgfVxuXG4gIFxuICBjb25zb2xlLmxvZygnaGVsbG8nKVxuICB3aW5kb3cuZmFrZSA9IHJlcztcblxuICAvLyBBZGQgYWRkcmVzc1xuICBpZiAocmVzLnZlbnVlLmxvY2F0aW9uLmFkZHJlc3MgIT09IHVuZGVmaW5lZCkge1xuICAgIGpzVmVudWVXZWJzaXRlLmlubmVySFRNTCA9IHJlcy52ZW51ZS5sb2NhdGlvbi5hZGRyZXNzICsgJywgJyArIHJlcy52ZW51ZS5sb2NhdGlvbi5jaXR5O1xuICB9XG5cbiAgLy8gSW5zZXJ0IE1pbmkgbWFwIHdpdGggdXNlciBsb2NhdGlvbiBodHRwczovL2xlYWZsZXRqcy5jb20vcmVmZXJlbmNlLTEuMC4wLmh0bWxcbiAgLy8gcmVtb3ZlIHByZXZpb3VzbHkgbG9hZGVkIG1hcCBmaXJzdFxuXG4gIC8vIGlmIChtaW5pTWFwKSB7XG4gIC8vICAgbWluaU1hcC5yZW1vdmUoKTtcbiAgLy8gfVxuICAvLyBsZXQgdXNlckxvY2F0aW9uID0gWy0zNi44OTc3OTMxLCAxNzQuNzg1NDk3M107XG4gIC8vIGxldCBtaW5pTWFwID0gTC5tYXAoJ2pzTWluaU1hcCcsIHtcbiAgLy8gICBzY3JvbGxXaGVlbFpvb206IGZhbHNlXG4gIC8vIH0pLnNldFZpZXcodXNlckxvY2F0aW9uLCAxNyk7XG4gIC8vIEwudGlsZUxheWVyKCdodHRwczovL2FwaS50aWxlcy5tYXBib3guY29tL3Y0L3tpZH0ve3p9L3t4fS97eX0ucG5nP2FjY2Vzc190b2tlbj17YWNjZXNzVG9rZW59Jywge1xuICAvLyAgIGF0dHJpYnV0aW9uOiAnTWFwIGRhdGEgJmNvcHk7IDxhIGhyZWY9XCJodHRwczovL3d3dy5vcGVuc3RyZWV0bWFwLm9yZy9cIj5PcGVuU3RyZWV0TWFwPC9hPiBjb250cmlidXRvcnMsIDxhIGhyZWY9XCJodHRwczovL2NyZWF0aXZlY29tbW9ucy5vcmcvbGljZW5zZXMvYnktc2EvMi4wL1wiPkNDLUJZLVNBPC9hPiwgSW1hZ2VyeSDCqSA8YSBocmVmPVwiaHR0cHM6Ly93d3cubWFwYm94LmNvbS9cIj5NYXBib3g8L2E+JyxcbiAgLy8gICBtYXhab29tOiAxOCxcbiAgLy8gICBpZDogJ21hcGJveC5zdHJlZXRzJyxcbiAgLy8gICBhY2Nlc3NUb2tlbjogJ3BrLmV5SjFJam9pYm1scmFYUmhhRzlwYm1Weklpd2lZU0k2SW1OcWMyMDNjSE41TkRFd2FHZzBPWEJwWW5FMGFYaGhabVlpZlEuNThsOGRVWmc0dWlGbjdCWW5aQ0pGQSdcbiAgLy8gfSkuYWRkVG8obWluaU1hcCk7XG5cbiAgLy8gTm93IHRvZ2dsZSB0aGUgTW9kYWxcbiAgJCgnI21vZGFsQ2VudGVyJykubW9kYWwoJ3Nob3cnKTtcblxuXG59O1xuLy8gV29yayBmcm9tIExvdWVsbGFcblxuXG5cbi8vIC8vIE1vZGFsIGlkZW50aWZpZXJzXG4vLyBjb25zdCBqc1BvcFVwQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJyNtb2RhbENlbnRlcicpO1xuLy8gY29uc3QganNNb2RhbExvbmdUaXRsZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdqc01vZGFsTG9uZ1RpdGxlJyk7XG4vLyBjb25zdCBqc1ZlbnVlSW1nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2pzVmVudWVJbWcnKTtcbi8vIGNvbnN0IGpzVmVudWVEZXNjcmlwdGlvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdqc1ZlbnVlRGVzY3JpcHRpb24nKTtcbi8vIGNvbnN0IGpzVmVudWVXZWJzaXRlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2pzVmVudWVXZWJzaXRlJyk7XG4vLyBjb25zdCBqc01pbmlNYXAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnanNNaW5pTWFwJyk7XG4vLyBjb25zdCBqc0RpcmVjdGlvbnMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnanNEaXJlY3Rpb25zJyk7XG5cbi8vIExvYWQgbW9kYWxcbi8vIGZ1bmN0aW9uIG1vZGFsKCkge1xuLy8gICAgICQoJyNtb2RhbENlbnRlcicpLm9uKCdzaG93bi5icy5tb2RhbCcsIGZ1bmN0aW9uICgpIHtcbi8vICAgICAgICAgLy9BZGQgdmVudWUgZGV0YWlscyB0aHJvdWdoIEFQSSBjYWxsXG4vLyAgICAgICAgIGRpc3BsYXlWZW51ZURldGFpbHModmVudWVVcmwpO1xuLy8gICAgIH0pO1xuLy8gfVxuXG4vLyAvLyBTdGVwIDMgLSBDcmVhdGUgdGhlIHZlbnVlIG9uIGNsaWNrIHJlcXVlc3QgdXJsXG4vLyBjb25zdCB2ZXJzaW9uID0gJz92PTIwMTcwOTAxJztcbi8vIGNvbnN0IGtleSA9IHZlcnNpb24gKyBjbGllbnRfaWQgKyBjbGllbnRfc2VjcmV0O1xuLy8gY29uc3QgdmVudWVJZCA9ICc1OWE0NTkyMTM1MWUzZDQzYjA3MDI4YjUnO1xuLy8gY29uc3QgYmFzZVVSTCA9ICdodHRwczovL2FwaS5mb3Vyc3F1YXJlLmNvbS92Mi92ZW51ZXMvJztcbi8vIGxldCB2ZW51ZVVybCA9IGJhc2VVUkwgKyB2ZW51ZUlkICsga2V5O1xuXG5cbi8vIGRpc3BsYXlWZW51ZURldGFpbHModmVudWVVcmwpO1xuLy8gLy8gU3RlcCA0IC0gTWFrZSB0aGUgYWN0dWFsIHJlcXVlc3Rcbi8vIGZ1bmN0aW9uIGRpc3BsYXlWZW51ZURldGFpbHModXJpKSB7XG4vLyAgICAgZmV0Y2godXJpKVxuLy8gICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbi8vICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7XG4vLyAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZS5qc29uKTtcbi8vICAgICAgICAgfSlcbi8vICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuLy8gICAgICAgICAgICAgLy8gQ29kZSBmb3IgaGFuZGxpbmcgZXJyb3JzXG4vLyAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4vLyAgICAgICAgIH0pO1xuLy8gfVxuXG5cblxuXG5cblxuIl0sImZpbGUiOiJhcHAubWluLmpzIn0=
